#!/usr/bin/env node
import Z from"mri";function K(t,e=process.argv.slice(2)){let i=Z(e),n={_:i._};for(let[o,{type:r,alias:p,default:f=r==="boolean"?!1:null}]of Object.entries(t)){if(n[o]=f,p){let s=p.slice(1);i[s]!==void 0&&(n[o]=B(i[s],r))}{let s=o.slice(2);i[s]!==void 0&&(n[o]=B(i[s],r))}}return n}function B(t,e){switch(e){case"string":return k(t);case"boolean":return S(t);case"number":return A(t);case"boolean | string":return S(t)??k(t);case"number | string":return A(t)??k(t);case"boolean | number":return S(t)??A(t);case"boolean | number | string":return S(t)??A(t)??k(t);default:throw new Error(`Unhandled type: ${e}`)}}function S(t){if(t===!0||t===!1)return t;if(t==="true")return!0;if(t==="false")return!1}function A(t){if(typeof t=="number")return t;{let e=Number(t);if(!Number.isNaN(e))return e}}function k(t){return`${t}`}import rt from"@parcel/watcher";import{IO as ot,Parsing as st,scanDir as q,scanFiles as lt}from"@tailwindcss/oxide";import{Features as V,transform as pt}from"lightningcss";import{existsSync as ut}from"node:fs";import E from"node:fs/promises";import F from"node:path";import at from"postcss";import ft from"postcss-import";import{compile as G}from"tailwindcss";import et from"node:fs";import P from"node:path";import{stripVTControlCharacters as nt}from"node:util";import d from"picocolors";import{createRequire as tt}from"node:module";var x=tt(import.meta.url).resolve;function L(t){let e=typeof t=="number"?BigInt(t):t;return e<1000n?`${e}ns`:(e/=1000n,e<1000n?`${e}\xB5s`:(e/=1000n,e<1000n?`${e}ms`:(e/=1000n,e<60n?`${e}s`:(e/=60n,e<60n?`${e}m`:(e/=60n,e<24n?`${e}h`:(e/=24n,`${e}d`))))))}var O={indent:2};function $(){let{version:t}=JSON.parse(et.readFileSync(x("tailwindcss/package.json"),"utf-8"));return`${d.italic(d.bold(d.blue("\u2248")))} tailwindcss ${d.blue(`v${t}`)}`}function N(t){return`${d.dim(d.blue("`"))}${d.blue(t)}${d.dim(d.blue("`"))}`}function W(t,e=process.cwd(),{preferAbsoluteIfShorter:i=!0}={}){let n=P.relative(e,t);return n.startsWith("..")||(n=`.${P.sep}${n}`),i&&n.length>t.length?t:n}function R(t,e){let i=t.split(" "),n=[],o="",r=0;for(let p of i){let f=nt(p).length;r+f+1>e&&(n.push(o),o="",r=0),o+=(r?" ":"")+p,r+=f+(r?1:0)}return r&&n.push(o),n}function z(t){let e=L(t);return t<=50*1e6?d.green(e):t<=300*1e6?d.blue(e):t<=1e3*1e6?d.yellow(e):d.red(e)}function T(t,e=0){return`${" ".repeat(e+O.indent)}${t}`}function g(t=""){process.stderr.write(`${t}
`)}function u(t=""){process.stdout.write(`${t}
`)}import I from"node:fs/promises";import it from"node:path";function M(){return new Promise((t,e)=>{let i="";process.stdin.on("data",n=>{i+=n}),process.stdin.on("end",()=>t(i)),process.stdin.on("error",n=>e(n))})}async function U(t,e){try{if(await I.readFile(t,"utf8")===e)return}catch{}await I.mkdir(it.dirname(t),{recursive:!0}),await I.writeFile(t,e,"utf8")}var J=String.raw;function _(){return{"--input":{type:"string",description:"Input file",alias:"-i"},"--output":{type:"string",description:"Output file",alias:"-o"},"--watch":{type:"boolean | string",description:"Watch for changes and rebuild as needed",alias:"-w"},"--minify":{type:"boolean",description:"Optimize and minify the output",alias:"-m"},"--optimize":{type:"boolean",description:"Optimize the output without minifying"},"--cwd":{type:"string",description:"The current working directory",default:"."}}}async function H(t){let e=F.resolve(t["--cwd"]);t["--output"]&&(t["--output"]=F.resolve(e,t["--output"])),t["--input"]&&t["--input"]!=="-"&&(t["--input"]=F.resolve(e,t["--input"]),ut(t["--input"])||(g($()),g(),g(`Specified input file ${N(W(t["--input"]))} does not exist.`),process.exit(1)));let i=process.hrtime.bigint(),{candidates:n}=q({base:e}),[o,r]=await Y(t["--input"]?t["--input"]==="-"?await M():await E.readFile(t["--input"],"utf-8"):J`
          @import '${x("tailwindcss/index.css")}';
        `,t["--input"]??e),p={css:"",optimizedCss:""};async function f(l,a){let m=l;if(a["--minify"]||a["--optimize"])if(l!==p.css){let h=ct(l,{file:a["--input"]??"input.css",minify:a["--minify"]??!1});p.css=l,p.optimizedCss=h,m=h}else m=p.optimizedCss;a["--output"]?await U(a["--output"],m):u(m)}let{build:s}=G(o);await f(s(n),t);let c=process.hrtime.bigint();g($()),g(),g(`Done in ${z(c-i)}`),t["--watch"]&&(await rt.subscribe(e,async(l,a)=>{if(l){console.error(l);return}try{if(a.length===1&&a[0].path===t["--output"])return;let m=[],h="incremental";for(let y of a)if((y.type==="create"||y.type==="update")&&m.push({file:y.path,extension:F.extname(y.path).slice(1)}),r.includes(y.path)){h="full";break}let C=process.hrtime.bigint(),w="";if(h==="full")n=q({base:e}).candidates,[o,r]=await Y(t["--input"]?await E.readFile(t["--input"],"utf-8"):J`
                  @import '${x("tailwindcss/index.css")}';
                `,t["--input"]??e),s=G(o).build,w=s(n);else if(h==="incremental"){let y=lt(m,ot.Sequential|st.Sequential);w=s(y)}await f(w,t);let X=process.hrtime.bigint();g(`Done in ${z(X-C)}`)}catch(m){m instanceof Error&&g(m.toString())}}),t["--watch"]!=="always"&&process.stdin.on("end",()=>{process.exit(0)}),process.stdin.resume())}function Y(t,e){return t.includes("@import")?at().use(ft()).process(t,{from:e}).then(i=>[i.css,[e].concat(i.messages.filter(n=>n.type==="dependency").map(n=>n.file))]):[t,[e]]}function ct(t,{file:e="input.css",minify:i=!1}={}){return pt({filename:e,code:Buffer.from(t),minify:i,sourceMap:!1,drafts:{customMedia:!0},nonStandard:{deepSelectorCombinator:!0},include:V.Nesting,exclude:V.LogicalProperties,targets:{safari:16<<16|1024},errorRecovery:!0}).code.toString()}import b from"picocolors";function j({invalid:t,usage:e,options:i}){let n=process.stdout.columns;if(u($()),t&&(u(),u(`${b.dim("Invalid command:")} ${t}`)),e&&e.length>0){u(),u(b.dim("Usage:"));for(let[o,r]of e.entries()){let p=r.slice(0,r.indexOf("[")),f=r.slice(r.indexOf("["));f=f.replace(/\[.*?\]/g,l=>b.dim(l));let c=R(f,n-O.indent-p.length-1);c.length>1&&o!==0&&u(),u(T(`${p}${c.shift()}`));for(let l of c)u(T(l,p.length))}}if(i){let o=0;for(let{alias:s}of Object.values(i))s&&(o=Math.max(o,s.length));let r=[],p=0;for(let[s,{alias:c}]of Object.entries(i)){let l=[c&&`${c.padStart(o)}`,c?s:" ".repeat(o+2)+s].filter(Boolean).join(", ");r.push(l),p=Math.max(p,l.length)}u(),u(b.dim("Options:"));let f=8;for(let{description:s,default:c=null}of Object.values(i)){let l=r.shift(),a=f+(p-l.length),m=2,h=n-l.length-a-m-O.indent,C=R(c!==null?`${s} ${b.dim(`[default:\u202F${N(`${c}`)}]`)}`:s,h);u(T(`${b.blue(l)} ${b.dim(b.gray("\xB7")).repeat(a)} ${C.shift()}`));for(let w of C)u(T(`${" ".repeat(l.length+a+m)}${w}`))}}}var D={"--help":{type:"boolean",description:"Display usage information",alias:"-h"}},v=K({..._(),...D}),Q=v._[0];Q&&(j({invalid:Q,usage:["tailwindcss [options]"],options:{..._(),...D}}),process.exit(1));(process.stdout.isTTY&&!v["--output"]||v["--help"])&&(j({usage:["tailwindcss [--input input.css] [--output output.css] [--watch] [options\u2026]"],options:{..._(),...D}}),process.exit(0));H(v);
